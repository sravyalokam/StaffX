<div *ngIf="isLoading"
  class="overlay-loader w-full h-full fixed top-0 left-0 flex items-center justify-center bg-white/50 z-50">
  <mat-spinner></mat-spinner>
</div>


<!-- Vendors  -->
 
<div class="p-6" *ngIf="showVendorsComponent">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Vendors</h1>
    </div>

    <app-my-utility 
    label="Add Vendor" 
    variant="#394253" 
    [icon]="plusIcon" 
    (clicked)="openAddNewVendorForm()" 
    type='button'>
    </app-my-utility>
  </div>


  <div class="bg-white rounded-lg shadow overflow-hidden ">
    <div class="overflow-x-auto h-[65vh] relative">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="sticky top-0 z-20 bg-gray-50 ">
          <tr class="text-left">
            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider relative">NAME</th>
            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider relative">LOCATION</th>
            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider relative">CONTACTS</th>
            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider relative">CANDIDATES</th>
            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider relative">ACTIONS</th>
          </tr>
        </thead>
        <tbody  class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let v of vendorsData" class="border border-gray-200 text-left hover:bg-gray-50 transition-colors">
            <td class="px-3 py-2 whitespace-nowrap text-sm">{{ v.name }}</td>

            <td class="px-3 py-2 whitespace-nowrap text-sm">{{ v.location }}</td>

            <td class="px-3 py-2 whitespace-nowrap text-sm">
              <span *ngIf="v.contacts.length > 0; else noContactDash" class="flex gap-3 items-center ">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="lucide lucide-user text-blue-600 ">
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
              <span class="text-blue-600 font-bold">{{ v.contacts.length }}</span>

              </span>
              <ng-template #noContactDash>-</ng-template>
            </td>

            <td class="px-3 py-2 whitespace-nowrap text-sm">
              <span *ngIf="v.resources_count; else noResources" class="flex gap-2 items-center">
                <button class="flex items-center" (click)="toggleRequirementsComponent(v.id)"
                >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="lucide lucide-briefcase w-4 h-4 text-blue-600 mr-2">
                  <rect width="20" height="14" x="2" y="7" rx="2" ry="2"></rect>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
  
  
                <span class=" text-blue-600 text-[14px] font-bold mr-2 flex items-center justify-center">
                  {{ v.resources_count }}
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="lucide lucide-arrow-up-right w-4 h-4 text-blue-600">
                  <path d="M7 7h10v10"></path>
                  <path d="M7 17 17 7"></path>
                </svg>
              </button>

            </span>
              <ng-template #noResources>-</ng-template>
            </td>

            <td class="px-3 py-2 whitespace-nowrap text-sm">
              <button type="button"
                class="inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gray-100 text-gray-900 hover:bg-gray-200 focus:ring-gray-400 shadow-sm hover:shadow-md transform hover:scale-105 transition-all duration-200 px-3 py-1.5 text-sm "><svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="lucide lucide-square-pen w-4 h-4">
                  <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"></path>
                </svg>
              </button>
            </td>

          </tr>
        </tbody>
      </table>
    </div>


    <app-pagination-utility 
      [currentPage]="currentPage" 
      [totalPages]="totalPages" 
      [totalItems]="totalItems"
      [pageSize]="pageSize" 
      (onPageChange)="onPageChange($event)" 
      (onPageSizeChange)="onPageSizeChange($event)"
      (onJumpToPage)="onJumpToPage($event)">
    </app-pagination-utility>

  </div>

</div>



<!-- Candidates Reuse -->

<app-candidates
 *ngIf="showCandidatesComponent"
 [vendorId]="selectedVendorId">
</app-candidates>









<div *ngIf="isAddNewVendorFormOpen"
  class="fixed right-0 top-0 h-full w-full max-w-md bg-white z-50 shadow-xl transition-transform duration-300 ase-in-out flex flex-col mt-15">
  
  <div class="flex items-center justify-between px-6 py-3 border-b border-gray-200">
    <h2 class="text-lg font-semibold text-gray-900">Add New Vendor</h2>
    <button class="text-gray-400 hover:text-gray-600 transition-colors" (click)="closeAddNewVendorForm()">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>


  <div class="flex-1 overflow-y-auto">

    <form [formGroup]="addNewVendorForm" (ngSubmit)="onAddVendorFormSubmit()" class="p-6 space-y-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Vendor Name <span class="text-red-500">*</span>
        </label>
        <input type="text" maxlength="200"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 border-gray-300 focus:ring-blue-500"
          value="" formControlName="vendorName">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Location
        </label>

        <input type="text" maxlength="200"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 border-gray-300 focus:ring-blue-500"
          value="" formControlName="Location">

      </div>


      <div>
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-medium text-lg text-gray-900">Contacts</h3>
          <app-my-utility label="Add Vendor Contact" variant="#F3F4F6" textColor="#111827" (clicked)="addContact()">
          </app-my-utility>
        </div>
      </div>


      <div class="space-y-4" *ngIf="openContactsForm">
        <div class="space-y-3">

          <div formArrayName="Contacts" class="p-3 border rounded-md">
            <div class="space-y-4" *ngFor="let contact of contacts.controls; let i = index" [formGroupName]="i">
              <div class="grid grid-cols-3 gap-3">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>

                  <input type="text" maxlength="200"
                    class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 border-gray-300 focus:ring-blue-500"
                    value="" formControlName="name">

                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>

                  <input type="text" maxlength="200"
                    class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 border-gray-300 focus:ring-blue-500"
                    value="" formControlName="email">
                </div>

                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>

                  <input type="text" maxlength="200"
                    class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 border-gray-300 focus:ring-blue-500"
                    value="" formControlName="phone">
                </div>


              </div>

              <div class="flex justify-end space-x-2 mt-4">
                <app-my-utility label="Cancel" variant="transparent" (clicked)="cancelContact(i)"
                  textColor="text-black"></app-my-utility>
                <app-my-utility label="Save Contact" variant="secondary" (clicked)="saveContactInfo(i)"
                  [disabled]="contact.invalid"></app-my-utility>
              </div>
            </div>
          </div>

          <div *ngIf="savedContacts.length > 0; " class="mt-6">
            <h3 class="text-lg font-bold">Saved Contacts:</h3>
            <div *ngFor="let c of savedContacts" class="mt-4 p-4 rounded border border-gray-300 flex justify-between">
              <div>
                <p class="font-bold">{{ c.name }}</p>
                <p>{{ c.email }}</p>
                <p>{{ c.phone }}</p>
              </div>
              <div class="flex space-x-2">
                <button type="button" class="text-blue-600 hover:text-blue-800">
                  <i class="fas fa-edit"></i>
                </button>
                <button type="button" class="text-red-600 hover:text-red-800">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          </div>


        </div>
        <ng-template *ngIf="!openContactsForm">
          <!-- <p class="text-sm text-gray-500">No contacts added yet.</p> -->
          <div class="space-y-4">
            <div class="space-y-3">
              <div class="text-sm text-gray-500">
                No contacts added.
              </div>
            </div>
          </div>
        </ng-template>
      </div>




      <div class=" flex justify-end">
        <app-my-utility label="Add Vendor" variant="secondary" type="submit" 
         [disabled]="addNewVendorForm.invalid || ( isAddNewVendorFormSubmitted && addNewVendorForm.invalid)">
        </app-my-utility>
      </div>
    </form>

  </div>


</div>

